\documentclass{beamer}
\usetheme{Warsaw}

\usepackage{graphicx} % Allows including images
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage{listings}
\usepackage[utf8]{inputenc}
\usepackage[overlay,absolute]{textpos}
\usepackage{adjustbox}
\usepackage[]{algorithm2e}

\AtBeginSection[]
{
\begin{frame}<beamer>
\frametitle{Plan}
\tableofcontents[
  currentsection,
  hideothersubsections
]
\end{frame}
}

\lstset{language=C++,
        basicstyle=\ttfamily,
        keywordstyle=\color{green}\ttfamily,
        stringstyle=\color{red}\ttfamily,
        commentstyle=\color{cyan}\ttfamily,
        morecomment=[l][\color{magenta}]{\#}
}

\setbeamercolor{normal text}{fg=white,bg=black!90}
\setbeamercolor{structure}{fg=white}

\setbeamercolor{alerted text}{fg=red!85!black}

\setbeamercolor{item projected}{use=item,fg=black,bg=item.fg!35}

\setbeamercolor*{palette primary}{use=structure,fg=structure.fg}
\setbeamercolor*{palette secondary}{use=structure,fg=structure.fg!95!black}
\setbeamercolor*{palette tertiary}{use=structure,fg=structure.fg!90!black}
\setbeamercolor*{palette quaternary}{use=structure,fg=structure.fg!95!black,bg=black!80}

\setbeamercolor*{framesubtitle}{fg=white}

\setbeamercolor*{block title}{parent=structure,bg=black!60}
\setbeamercolor*{block body}{fg=black,bg=black!10}
\setbeamercolor*{block title alerted}{parent=alerted text,bg=black!15}
\setbeamercolor*{block title example}{parent=example text,bg=black!15}

\author[Félix-Antoine Ouellet]{Félix-Antoine Ouellet}

\title[MTL\hspace{2em}\insertframenumber/\inserttotalframenumber]{Mémoire transactionnelle logicielle}

\institute{Université de Sherbrooke}

\date{23 octobre 2014}

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
\tableofcontents[hideallsubsections]
\end{frame}

\section{Motivation}
\subsection{Programmation parallèle traditionnelle}

\newlength\someheight
\setlength\someheight{3.5cm}

\begin{frame}[fragile]
\frametitle{Programmation parallèle traditionnelle}
\framesubtitle{Exemple}
\begin{adjustbox}{width=\textwidth,height=\someheight,keepaspectratio}
\begin{lstlisting}
class Account {
public:
  void deposit(int n) {
    m_Mutex.lock();
    m_Balance += n;
    m_Mutex.unlock();
  }

  void withdraw(int n) {
    m_Mutex.lock();
    if (m_Balance >= n) {
      m_Balance -= n;
    }
    m_Mutex.unlock();
  }
};
\end{lstlisting}
\end{adjustbox}
\end{frame}

\begin{frame}[fragile]
\frametitle{Programmation parallèle traditionnelle}
\framesubtitle{Exemple}
\begin{lstlisting}
void transfer(Account & From, Account & To, 
              int Amount) {
  From.withdraw(Amount);
  To.deposit(Amount);
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{Programmation parallèle traditionnelle}
\framesubtitle{Exemple}
\begin{lstlisting}
void transfer(Account & From, Account & To, 
              int Amount) {
  From.lock();
  To.lock();
  From.withdraw(Amount);
  To.deposit(Amount);
  From.unlock();
  To.unlock();
}
\end{lstlisting}
\end{frame}

\subsection{Problèmes}
\begin{frame}
\frametitle{Problèmes}
\begin{itemize}
\item Problèmes de synchronisation
\item<3-> Difficile à composer
\item<4-> Penser parallèle
\end{itemize}
\end{frame}

\section{Mémoire transactionnelle}
\subsection{Concept}
\begin{frame}
\frametitle{Concept}
\begin{itemize}
\item Suite d'instructions exécutées d'une manière semblable aux transactions dans une base de données
\begin{itemize}
\item<2-> Atomique: Aucun état intermédiaire visible
\item<3-> Isolée: Non affectée par les autres \textit{threads}
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Concept}
\framesubtitle{Exemple}
\begin{lstlisting}
void transfer(Account & From, Account & To, 
              int Amount) {
  atomic {
    From.withdraw(Amount);
    To.deposit(Amount);
  }
}
\end{lstlisting}
\end{frame}

\subsection{Possible implémentation}
\begin{frame}
\frametitle{Possible implémentation}
\begin{algorithm}[H]
 Associer un \textit{log} à chaque variable impliquée dans une transaction (globalement)\;
 \While{Transaction non valide}{
  Exécuter instructions sur une copie courante des variables\;
  Valider transaction (atomiquement)\;
  \If{Transaction valide}{
  Écrire transaction (atomiquement)\;
   }
 }
\end{algorithm}
\end{frame}

\subsection{Avantages}
\begin{frame}
\frametitle{Avantages}
\begin{itemize}
\item Composable
\item<2-> Élimine les possibilités de \textit{deadlock}
\item<3-> Facilite le raisonnement
\end{itemize}
\end{frame}

\subsection{Problèmes potentiels}
\begin{frame}
\frametitle{Problèmes potentiels}
\begin{itemize}
\item Problèmes d'implémentation et de performance
\item<2-> Interactions avec code non-transactionnel
\item<3-> Gestions des exceptions
\end{itemize}
\end{frame}

\section{Support présent}
\subsection{Langages de programmation}
\begin{frame}[fragile]
\frametitle{C++}
Extension disponible dans GCC depuis GCC 4.7
\begin{lstlisting}
void transfer(Account & From, Account & To, 
              int Amount) {
  __transaction_atomic {
    From.withdraw(Amount);
    To.deposit(Amount);
  }
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{C++}
En voie d'être standardisé pour C++17
\begin{lstlisting}
void transfer(Account & From, Account & To, 
              int Amount) {
  atomic_noexcept {
    From.withdraw(Amount);
    To.deposit(Amount);
  }
}
\end{lstlisting}
\end{frame}

\subsection{Matériel}
\begin{frame}
\frametitle{Matériel}
\begin{center}
\colorbox{white}{\includegraphics[scale=0.15]{haswell.jpg}}
\end{center}
\end{frame}

\section{Conclusion}
\begin{frame}
\frametitle{Conclusion}
\begin{itemize}
\item Avenue intéressante pour le futur de la programmation parallèle
\item<2-> Loin d'être arriver à maturité
\end{itemize}
\end{frame}

\end{document}